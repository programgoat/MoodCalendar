<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>æ°—åˆ†ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‹æ°—åˆ†ãƒ­ã‚°çµ±åˆç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #0f172a;
      --card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --danger: #f97373;
      --success: #4ade80;
      --border: #1f2937;
      --radius-lg: 18px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.9);
      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 1120px;
      background: linear-gradient(145deg, #020617 0%, #020617 55%, #020617 100%);
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.18);
      box-shadow: var(--shadow-soft);
      padding: 22px 22px 18px;
      position: relative;
      overflow: hidden;
    }

    .app::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.18) 0, transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.18) 0, transparent 55%);
      opacity: 0.7;
      pointer-events: none;
    }

    .app-inner {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 18px;
    }

    @media (max-width: 900px) {
      .app-inner {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
    }

    .title-block {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0%, #38bdf8 0, #0ea5e9 40%, #1d4ed8 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e5f3ff;
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.7),
        0 10px 25px rgba(56, 189, 248, 0.45);
    }

    .title-text-main {
      font-size: 18px;
      font-weight: 600;
      letter-spacing: 0.03em;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .title-pill {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--text-sub);
      background: rgba(15, 23, 42, 0.7);
    }

    .title-text-sub {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-sub);
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--success);
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.18);
    }

    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.8);
    }

    .pill strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129, 140, 248, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.96);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 16px 16px 14px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(148, 163, 184, 0.25),
        transparent 40%,
        transparent 60%,
        rgba(148, 163, 184, 0.18)
      );
      opacity: 0.12;
      pointer-events: none;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-title {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .card-subtitle {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .badge {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.5);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .badge-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ */
    .calendar-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .calendar-header button {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
      cursor: pointer;
      font-size: 11px;
      transition: background var(--transition-fast), border-color var(--transition-fast),
        color var(--transition-fast), transform var(--transition-fast);
    }

    .calendar-header button:hover {
      border-color: var(--accent);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.98);
      transform: translateY(-1px);
    }

    .calendar-header strong {
      font-size: 14px;
    }

    .weekday-row {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 4px;
      font-size: 11px;
      color: var(--text-sub);
      text-align: center;
    }

    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }

    .day {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 6px;
      text-align: right;
      cursor: pointer;
      transition: 0.18s;
      min-height: 52px;
      position: relative;
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .day:hover {
      border-color: var(--accent);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
    }

    .day-number {
      font-size: 12px;
      font-weight: 500;
      color: #e5e7eb;
    }

    .day-mood-label {
      font-size: 10px;
      opacity: 0.9;
      text-align: left;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .day-today {
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.7);
    }

    /* æ°—åˆ†è‰² */
    .mood-bad { background: linear-gradient(145deg, #7f1d1d, #b91c1c) !important; }
    .mood-meh { background: linear-gradient(145deg, #111827, #374151) !important; }
    .mood-good { background: linear-gradient(145deg, #14532d, #16a34a) !important; }
    .mood-great { background: linear-gradient(145deg, #78350f, #f59e0b) !important; }

    .mood-bad .day-number,
    .mood-meh .day-number,
    .mood-good .day-number,
    .mood-great .day-number {
      color: #f9fafb;
    }

    .mood-bad .day-mood-label,
    .mood-meh .day-mood-label,
    .mood-good .day-mood-label,
    .mood-great .day-mood-label {
      color: #e5e7eb;
    }

    /* å³å´ï¼šè©³ç´°ï¼†ã‚°ãƒ©ãƒ• */
    .right-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .stat-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .stat-card {
      flex: 1;
      min-width: 0;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      padding: 8px 9px;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .stat-value {
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .stat-value span {
      font-size: 11px;
      color: var(--text-sub);
    }

    .stat-pill {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.12);
      color: #4ade80;
      font-size: 10px;
      border: 1px solid rgba(34, 197, 94, 0.4);
    }

    .stat-pill.bad {
      background: rgba(248, 113, 113, 0.12);
      color: #fca5a5;
      border-color: rgba(248, 113, 113, 0.5);
    }

    .selected-day-info {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    .selected-day-info strong {
      color: #e5e7eb;
    }

    .note-box {
      margin-top: 6px;
      border-radius: var(--radius-md);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      padding: 7px 8px;
      font-size: 11px;
      color: var(--text-sub);
      background: rgba(15, 23, 42, 0.85);
      min-height: 40px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .note-empty {
      opacity: 0.8;
    }

    /* ã‚°ãƒ©ãƒ•ï¼ˆç°¡æ˜“ï¼‰ */
    .graph {
      display: flex;
      align-items: flex-end;
      gap: 4px;
      height: 70px;
      margin-top: 4px;
    }

    .graph-bar {
      flex: 1;
      border-radius: 4px 4px 0 0;
      background: rgba(30, 64, 175, 0.4);
      position: relative;
      overflow: hidden;
    }

    .graph-bar-inner {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(180deg, #38bdf8, #0ea5e9);
    }

    .graph-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
      font-size: 9px;
      color: var(--text-sub);
    }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ°—åˆ†å…¥åŠ›UIï¼‰ */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease-out;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      width: 100%;
      max-width: 420px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at bottom right, rgba(129, 140, 248, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.98);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.95);
      padding: 14px 14px 12px;
      position: relative;
      transform: translateY(8px);
      transition: transform 0.18s ease-out;
    }

    .modal-backdrop.show .modal {
      transform: translateY(0);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 8px;
    }

    .modal-title {
      font-size: 13px;
      font-weight: 600;
    }

    .modal-subtitle {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .modal-close {
      border: none;
      background: transparent;
      color: var(--text-sub);
      cursor: pointer;
      font-size: 16px;
    }

    .mood-scale {
      display: flex;
      gap: 6px;
      margin-bottom: 8px;
    }

    .mood-option {
      flex: 1;
      padding: 7px 0;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast),
        transform var(--transition-fast), box-shadow var(--transition-fast), color var(--transition-fast);
    }

    .mood-option span {
      font-size: 13px;
    }

    .mood-option strong {
      font-weight: 500;
      color: #e5e7eb;
    }

    .mood-option:hover {
      border-color: var(--accent);
      background: rgba(15, 23, 42, 0.95);
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.7);
    }

    .mood-option.active {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.25), rgba(15, 23, 42, 0.98));
      color: #e5f3ff;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4),
        0 12px 30px rgba(56, 189, 248, 0.35);
    }

    .mood-option.active strong {
      color: #e5f3ff;
    }

    .textarea-label {
      font-size: 11px;
      color: var(--text-sub);
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .textarea-label span {
      opacity: 0.9;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 8px 10px;
      font-size: 12px;
      line-height: 1.5;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast),
        background var(--transition-fast), transform var(--transition-fast);
    }

    textarea::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5),
        0 12px 30px rgba(15, 23, 42, 0.9);
      background: rgba(15, 23, 42, 0.98);
      transform: translateY(-1px);
    }

    .modal-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-primary {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #38bdf8, #0ea5e9, #6366f1);
      color: #e5f3ff;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.55);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
        filter var(--transition-fast);
      white-space: nowrap;
    }

    .btn-primary span {
      font-size: 14px;
    }

    .btn-primary:hover {
      transform: translateY(-1px) translateZ(0);
      box-shadow: 0 16px 40px rgba(37, 99, 235, 0.7);
      filter: brightness(1.05);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.9);
      filter: brightness(0.98);
    }

    .btn-secondary {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-sub);
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: background var(--transition-fast), border-color var(--transition-fast),
        color var(--transition-fast), transform var(--transition-fast);
    }

    .btn-secondary:hover {
      border-color: var(--accent);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.98);
      transform: translateY(-1px);
    }

    .btn-secondary span {
      font-size: 13px;
    }

    .chip {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      transition: border-color var(--transition-fast), background var(--transition-fast),
        transform var(--transition-fast);
      font-size: 10px;
      color: var(--text-sub);
    }

    .chip:hover {
      border-style: solid;
      border-color: var(--accent);
      background: rgba(15, 23, 42, 0.95);
      transform: translateY(-1px);
    }

    .footer {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid rgba(30, 64, 175, 0.7);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 10px;
      color: var(--text-sub);
      flex-wrap: wrap;
    }

    .footer-left {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .footer-left strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .footer-right {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tiny-pill {
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.9);
    }

    .tiny-pill span {
      font-size: 11px;
    }

    .tiny-pill strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .pill-soft {
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 10px;
      color: var(--text-sub);
    }

    .pill-soft strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    .fade-in {
      animation: fadeIn 0.25s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="app-inner">
      <!-- å·¦ï¼šã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <div>
        <header class="header">
          <div class="title-block">
            <div class="logo">M</div>
            <div>
              <div class="title-text-main">
                Mood Calendar
                <span class="title-pill">v2</span>
              </div>
              <div class="title-text-sub">
                ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ã€1æ—¥ã®æ°—åˆ†ã¨ã²ã¨ã“ã¨ãƒ¡ãƒ¢ã‚’æ®‹ã™ã€‚
              </div>
            </div>
          </div>
          <div class="header-right">
            <div class="dot"></div>
            <div class="pill">
              <strong id="today-label"></strong> ã®ä»Šæ—¥
            </div>
          </div>
        </header>

        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Mood calendar</div>
              <div class="card-subtitle">
                æ—¥ä»˜ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãã®æ—¥ã®æ°—åˆ†ã¨ãƒ¡ãƒ¢ã‚’ç™»éŒ²ã§ãã¾ã™ã€‚
              </div>
            </div>
            <div class="badge">
              <span class="badge-dot"></span>
              local only / auto-save
            </div>
          </div>

          <div class="calendar-header">
            <button id="prev-month">â† å‰ã®æœˆ</button>
            <strong id="month-label"></strong>
            <button id="next-month">æ¬¡ã®æœˆ â†’</button>
          </div>

          <div class="weekday-row">
            <div>æ—¥</div><div>æœˆ</div><div>ç«</div><div>æ°´</div><div>æœ¨</div><div>é‡‘</div><div>åœŸ</div>
          </div>

          <div class="calendar" id="calendar"></div>
        </section>
      </div>

      <!-- å³ï¼šè©³ç´°ãƒ»çµ±è¨ˆ -->
      <div class="right-column">
        <section class="stat-row">
          <div class="stat-card">
            <div class="stat-label">
              <span>ä»Šæœˆã®å¹³å‡ãƒ ãƒ¼ãƒ‰</span>
              <span class="stat-pill" id="avg-pill">new</span>
            </div>
            <div class="stat-value">
              <span id="avg-score">â€“</span>
              <span>/ 4</span>
            </div>
            <div style="font-size:10px; color:var(--text-sub); margin-top:2px;">
              ä»Šæœˆç™»éŒ²ã•ã‚ŒãŸæ—¥ã ã‘ã‚’å¯¾è±¡ã«ã—ãŸã€ã–ã£ãã‚Šå¹³å‡å€¤ã§ã™ã€‚
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-label">
              <span>ç›´è¿‘7æ—¥é–“ã®è¨˜éŒ²</span>
              <span class="stat-pill bad" id="streak-pill">0 days</span>
            </div>
            <div class="stat-value">
              <span id="entry-count">0</span>
              <span>entries</span>
            </div>
            <div style="font-size:10px; color:var(--text-sub); margin-top:2px;">
              ã€Œæ¯æ—¥ã€ã˜ã‚ƒãªãã¦ã€ã€Œæ€ã„å‡ºã—ãŸã¨ãã«ã€ã¤ã‘ã‚‹ãã‚‰ã„ã§ååˆ†ã§ã™ã€‚
            </div>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Selected day</div>
              <div class="card-subtitle">
                ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§é¸æŠã—ãŸæ—¥ã®æ°—åˆ†ã¨ãƒ¡ãƒ¢ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
              </div>
            </div>
          </div>

          <div class="selected-day-info" id="selected-day-info">
            ã¾ã æ—¥ä»˜ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã©ã“ã‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
          </div>
          <div class="note-box" id="selected-note-box">
            <span class="note-empty">ãƒ¡ãƒ¢ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</span>
          </div>
        </section>

        <section class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Last 7 days mood</div>
              <div class="card-subtitle">
                ç›´è¿‘7æ—¥é–“ã®ãƒ ãƒ¼ãƒ‰ã‚’ã€ã–ã£ãã‚Šæ£’ã‚°ãƒ©ãƒ•ã§è¡¨ç¤ºã—ã¾ã™ï¼ˆ1ã€œ4ã®ã‚¹ã‚³ã‚¢ï¼‰ã€‚
              </div>
            </div>
          </div>

          <div class="graph" id="graph"></div>
          <div class="graph-labels" id="graph-labels"></div>
        </section>

        <footer class="footer">
          <div class="footer-left">
            <span>ãƒ‡ãƒ¼ã‚¿ã¯</span>
            <strong>ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘</strong>
            <span>ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</span>
            <span class="pill-soft">
              <strong>ãƒ­ã‚°ã‚¤ãƒ³ä¸è¦</strong> / ã‚µãƒ¼ãƒãƒ¼é€ä¿¡ãªã—
            </span>
          </div>
          <div class="footer-right">
            <div class="tiny-pill">
              <span>ğŸ’¡</span>
              <strong>ãƒ’ãƒ³ãƒˆ:</strong> ã€Œå®Œç’§ã«æ›¸ã“ã†ã€ã¨ã—ãªã„ã»ã†ãŒç¶šãã¾ã™ã€‚
            </div>
          </div>
        </footer>
      </div>
    </div>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼šæ°—åˆ†å…¥åŠ› -->
  <div class="modal-backdrop" id="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="modal-title">æ°—åˆ†ã‚’è¨˜éŒ²</div>
          <div class="modal-subtitle" id="modal-subtitle">
            ãã®æ—¥ã®ã€Œã–ã£ãã‚Šã—ãŸæ°—åˆ†ã€ã¨ã€ã²ã¨ã“ã¨ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠã‘ã¾ã™ã€‚
          </div>
        </div>
        <button class="modal-close" id="modal-close">Ã—</button>
      </div>

      <div class="mood-scale" id="mood-scale">
        <button class="mood-option" data-mood="bad">
          <span>ğŸ˜£</span>
          <strong>ã—ã‚“ã©ã„</strong>
        </button>
        <button class="mood-option" data-mood="meh">
          <span>ğŸ˜</span>
          <strong>ãµã¤ã†</strong>
        </button>
        <button class="mood-option" data-mood="good">
          <span>ğŸ™‚</span>
          <strong>ã‚ã‚Šã¨è‰¯ã„</strong>
        </button>
        <button class="mood-option" data-mood="great">
          <span>ğŸ˜„</span>
          <strong>æœ€é«˜</strong>
        </button>
      </div>

      <div class="textarea-label">
        <span>ã²ã¨ã“ã¨ãƒ¡ãƒ¢ï¼ˆã‚ã¨ã§èª­ã¿è¿”ã—ãŸããªã‚‹ãã‚‰ã„ã€ã–ã£ãã‚Šã§OKï¼‰</span>
        <span id="char-count">0 / 120</span>
      </div>
      <textarea
        id="note"
        maxlength="120"
        placeholder="ä¾‹ï¼‰æœã¯ã ã‚‹ã‹ã£ãŸã‘ã©ã€ãƒ©ãƒ³ãƒã§å°‘ã—æ°—åˆ†ãŒä¸ŠãŒã£ãŸã€‚å¤œã¯ã‚†ã£ãã‚Šã§ããã†ã€‚"
      ></textarea>

      <div class="modal-actions">
        <div style="display:flex; gap:6px; flex-wrap:wrap;">
          <button class="chip" type="button" data-template="å°ã•ãªè‰¯ã‹ã£ãŸã“ã¨ã‚’æ›¸ã„ã¦ã¿ã‚‹ï¼Ÿ">
            <span>âœ¨</span>
            è‰¯ã‹ã£ãŸã“ã¨ãƒ’ãƒ³ãƒˆ
          </button>
          <button class="chip" type="button" data-template="ã—ã‚“ã©ã•ã®åŸå› ã‚’ä¸€è¨€ã§æ›¸ã„ã¦ã¿ã‚‹ï¼Ÿ">
            <span>ğŸ§©</span>
            ã—ã‚“ã©ã•ã®æ­£ä½“
          </button>
        </div>
        <div style="display:flex; gap:6px; align-items:center;">
          <button class="btn-secondary" type="button" id="clear-btn">
            <span>ğŸ§¹</span>
            ã‚¯ãƒªã‚¢
          </button>
          <button class="btn-primary" type="button" id="save-btn">
            <span>â¤</span>
            Save
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ====== å…±é€šï¼šå‰ä½œã¨åŒã˜ãƒ‡ãƒ¼ã‚¿æ§‹é€  ====== */
    const STORAGE_KEY = "today-mood-log-v1";

    const moodMap = {
      bad: { label: "ã—ã‚“ã©ã„", emoji: "ğŸ˜£", score: 1, colorClass: "mood-bad" },
      meh: { label: "ãµã¤ã†", emoji: "ğŸ˜", score: 2, colorClass: "mood-meh" },
      good: { label: "ã‚ã‚Šã¨è‰¯ã„", emoji: "ğŸ™‚", score: 3, colorClass: "mood-good" },
      great: { label: "æœ€é«˜", emoji: "ğŸ˜„", score: 4, colorClass: "mood-great" },
    };

    function loadEntries() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveEntries(entries) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    }

    function formatDateLabel(date = new Date()) {
      const y = date.getFullYear();
      const m = date.getMonth() + 1;
      const d = date.getDate();
      const weekday = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"][date.getDay()];
      return `${y}/${m}/${d} (${weekday})`;
    }

    function formatTime(date = new Date()) {
      const h = String(date.getHours()).padStart(2, "0");
      const m = String(date.getMinutes()).padStart(2, "0");
      return `${h}:${m}`;
    }

    function escapeHtml(str) {
      return str
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    /* ====== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼é–¢é€£ ====== */
    const calendarEl = document.getElementById("calendar");
    const monthLabelEl = document.getElementById("month-label");
    const todayLabelEl = document.getElementById("today-label");

    let currentYear = new Date().getFullYear();
    let currentMonth = new Date().getMonth();

    let selectedDate = null; // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

    function sameDay(d1, d2) {
      return d1.getFullYear() === d2.getFullYear() &&
             d1.getMonth() === d2.getMonth() &&
             d1.getDate() === d2.getDate();
    }

    function renderCalendar() {
      calendarEl.innerHTML = "";

      const firstDay = new Date(currentYear, currentMonth, 1);
      const lastDay = new Date(currentYear, currentMonth + 1, 0);
      const daysInMonth = lastDay.getDate();

      monthLabelEl.textContent = `${currentYear}å¹´ ${currentMonth + 1}æœˆ`;

      const entries = loadEntries();

      // 1æ—¥ãŒä½•æ›œæ—¥ã‹
      const startWeekday = firstDay.getDay();
      for (let i = 0; i < startWeekday; i++) {
        const empty = document.createElement("div");
        calendarEl.appendChild(empty);
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const cellDate = new Date(currentYear, currentMonth, day);
        const div = document.createElement("div");
        div.className = "day";

        const num = document.createElement("div");
        num.className = "day-number";
        num.textContent = day;

        const label = document.createElement("div");
        label.className = "day-mood-label";

        const entry = entries
          .slice()
          .reverse()
          .find(e => {
            const d = new Date(e.createdAt);
            return sameDay(d, cellDate);
          });

        if (entry && moodMap[entry.mood]) {
          const mood = moodMap[entry.mood];
          div.classList.add(mood.colorClass);
          label.textContent = `${mood.emoji} ${mood.label}`;
        } else {
          label.textContent = "";
        }

        const today = new Date();
        if (sameDay(today, cellDate)) {
          div.classList.add("day-today");
        }

        div.appendChild(num);
        div.appendChild(label);

        div.addEventListener("click", () => {
          selectedDate = cellDate;
          openModalForDate(cellDate, entry || null);
          updateSelectedDayInfo();
        });

        calendarEl.appendChild(div);
      }

      updateStats();
      updateGraph();
      updateSelectedDayInfo();
    }

    /* ====== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆæ°—åˆ†å…¥åŠ›UIï¼‰ ====== */
    const modalBackdrop = document.getElementById("modal-backdrop");
    const modalClose = document.getElementById("modal-close");
    const moodScaleEl = document.getElementById("mood-scale");
    const noteEl = document.getElementById("note");
    const charCountEl = document.getElementById("char-count");
    const saveBtn = document.getElementById("save-btn");
    const clearBtn = document.getElementById("clear-btn");
    const modalTitleEl = document.getElementById("modal-title");
    const modalSubtitleEl = document.getElementById("modal-subtitle");

    let selectedMood = null;
    let editingDate = null; // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

    function openModalForDate(date, existingEntry) {
      editingDate = date;
      const label = formatDateLabel(date);
      modalTitleEl.textContent = `${label} ã®æ°—åˆ†`;
      modalSubtitleEl.textContent = "ãã®æ—¥ã®ã€Œã–ã£ãã‚Šã—ãŸæ°—åˆ†ã€ã¨ã€ã²ã¨ã“ã¨ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠã‘ã¾ã™ã€‚";

      document
        .querySelectorAll(".mood-option")
        .forEach((btn) => btn.classList.remove("active"));

      if (existingEntry && moodMap[existingEntry.mood]) {
        selectedMood = existingEntry.mood;
        const activeBtn = document.querySelector(
          `.mood-option[data-mood="${selectedMood}"]`
        );
        if (activeBtn) activeBtn.classList.add("active");
        noteEl.value = existingEntry.note || "";
      } else {
        selectedMood = null;
        noteEl.value = "";
      }

      updateCharCount();
      modalBackdrop.classList.add("show");
      noteEl.focus();
    }

    function closeModal() {
      modalBackdrop.classList.remove("show");
      editingDate = null;
      selectedMood = null;
    }

    function updateCharCount() {
      const len = noteEl.value.length;
      charCountEl.textContent = `${len} / 120`;
    }

    moodScaleEl.addEventListener("click", (e) => {
      const btn = e.target.closest(".mood-option");
      if (!btn) return;
      const moodKey = btn.getAttribute("data-mood");
      if (!moodKey) return;
      selectedMood = moodKey;
      document
        .querySelectorAll(".mood-option")
        .forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
    });

    noteEl.addEventListener("input", updateCharCount);

    document.querySelectorAll(".chip").forEach((chip) => {
      chip.addEventListener("click", () => {
        const template = chip.getAttribute("data-template") || "";
        if (!noteEl.value.trim()) {
          noteEl.value = template;
        } else {
          noteEl.value = noteEl.value.trim() + " " + template;
        }
        noteEl.focus();
        updateCharCount();
      });
    });

    saveBtn.addEventListener("click", () => {
      if (!editingDate) return;

      if (!selectedMood && !noteEl.value.trim()) {
        alert("æ°—åˆ†ã‹ãƒ¡ãƒ¢ã®ã©ã¡ã‚‰ã‹ä¸€æ–¹ã ã‘ã§ã‚‚å…¥åŠ›ã—ã¦ã¿ã¦ãã ã•ã„ã€‚");
        return;
      }

      const entries = loadEntries();
      const dateStr = editingDate.toDateString();

      const filtered = entries.filter(e => {
        const d = new Date(e.createdAt);
        return !sameDay(d, editingDate);
      });

      const now = new Date();
      const entry = {
        id: now.getTime(),
        mood: selectedMood || "meh",
        note: noteEl.value.trim(),
        createdAt: new Date(
          editingDate.getFullYear(),
          editingDate.getMonth(),
          editingDate.getDate(),
          now.getHours(),
          now.getMinutes()
        ).toISOString(),
        dateLabel: formatDateLabel(editingDate),
        timeLabel: formatTime(now),
      };

      filtered.push(entry);
      saveEntries(filtered);

      saveBtn.textContent = "Saved!";
      setTimeout(() => {
        saveBtn.innerHTML = '<span>â¤</span>Save';
      }, 900);

      renderCalendar();
      closeModal();
    });

    clearBtn.addEventListener("click", () => {
      noteEl.value = "";
      updateCharCount();
      selectedMood = null;
      document
        .querySelectorAll(".mood-option")
        .forEach((btn) => btn.classList.remove("active"));
    });

    modalClose.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) {
        closeModal();
      }
    });

    /* ====== å³å´ï¼šé¸æŠæ—¥ã®è¡¨ç¤º ====== */
    const selectedDayInfoEl = document.getElementById("selected-day-info");
    const selectedNoteBoxEl = document.getElementById("selected-note-box");

    function updateSelectedDayInfo() {
      if (!selectedDate) {
        selectedDayInfoEl.textContent =
          "ã¾ã æ—¥ä»˜ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ã©ã“ã‹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚";
        selectedNoteBoxEl.innerHTML =
          "<span class='note-empty'>ãƒ¡ãƒ¢ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</span>";
        return;
      }

      const entries = loadEntries();
      const entry = entries
        .slice()
        .reverse()
        .find(e => sameDay(new Date(e.createdAt), selectedDate));

      const label = formatDateLabel(selectedDate);
      if (!entry) {
        selectedDayInfoEl.innerHTML =
          `é¸æŠä¸­ã®æ—¥ä»˜: <strong>${label}</strong>ï¼ˆã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰`;
        selectedNoteBoxEl.innerHTML =
          "<span class='note-empty'>ãƒ¡ãƒ¢ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</span>";
      } else {
        const mood = moodMap[entry.mood] || moodMap.meh;
        selectedDayInfoEl.innerHTML =
          `é¸æŠä¸­ã®æ—¥ä»˜: <strong>${label}</strong><br>æ°—åˆ†: ${mood.emoji} <strong>${mood.label}</strong> / è¨˜éŒ²æ™‚åˆ»: ${entry.timeLabel}`;
        selectedNoteBoxEl.innerHTML = entry.note
          ? escapeHtml(entry.note)
          : "<span class='note-empty'>ãƒ¡ãƒ¢ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</span>";
      }
    }

    /* ====== çµ±è¨ˆï¼ˆå¹³å‡ãƒ»ä»¶æ•°ãƒ»7æ—¥ï¼‰ ====== */
    const avgScoreEl = document.getElementById("avg-score");
    const avgPillEl = document.getElementById("avg-pill");
    const entryCountEl = document.getElementById("entry-count");
    const streakPillEl = document.getElementById("streak-pill");
    const graphEl = document.getElementById("graph");
    const graphLabelsEl = document.getElementById("graph-labels");

    function updateStats() {
      const entries = loadEntries();
      entryCountEl.textContent = String(entries.length);

      const now = new Date();
      const sevenDaysAgo = new Date();
      sevenDaysAgo.setDate(now.getDate() - 6);

      const daysSet = new Set(
        entries
          .map((e) => new Date(e.createdAt))
          .filter((d) => d >= sevenDaysAgo && d <= now)
          .map((d) => d.toDateString())
      );

      const streak = daysSet.size;
      streakPillEl.textContent = `${streak} day${streak === 1 ? "" : "s"}`;

      const month = currentMonth;
      const year = currentYear;
      const monthEntries = entries.filter((e) => {
        const d = new Date(e.createdAt);
        return d.getMonth() === month && d.getFullYear() === year;
      });

      if (!monthEntries.length) {
        avgScoreEl.textContent = "â€“";
        avgPillEl.textContent = "new";
        avgPillEl.classList.remove("bad");
      } else {
        const avg =
          monthEntries.reduce((sum, e) => {
            const mood = moodMap[e.mood] || moodMap.meh;
            return sum + mood.score;
          }, 0) / monthEntries.length;

        const rounded = Math.round(avg * 10) / 10;
        avgScoreEl.textContent = String(rounded);

        if (rounded >= 3.2) {
          avgPillEl.textContent = "good";
          avgPillEl.classList.remove("bad");
        } else if (rounded <= 1.8) {
          avgPillEl.textContent = "low";
          avgPillEl.classList.add("bad");
        } else {
          avgPillEl.textContent = "steady";
          avgPillEl.classList.remove("bad");
        }
      }
    }

    function updateGraph() {
      const entries = loadEntries();
      const now = new Date();
      const days = [];

      for (let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(now.getDate() - i);
        days.push(d);
      }

      graphEl.innerHTML = "";
      graphLabelsEl.innerHTML = "";

      const labelsFrag = document.createDocumentFragment();

      days.forEach((day) => {
        const entry = entries
          .slice()
          .reverse()
          .find(e => sameDay(new Date(e.createdAt), day));

        const score = entry ? (moodMap[entry.mood] || moodMap.meh).score : 0;

        const bar = document.createElement("div");
        bar.className = "graph-bar";

        const inner = document.createElement("div");
        inner.className = "graph-bar-inner";
        const height = (score / 4) * 100;
        inner.style.height = `${height}%`;
        bar.appendChild(inner);
        graphEl.appendChild(bar);

        const label = document.createElement("div");
        label.textContent = `${day.getMonth() + 1}/${day.getDate()}`;
        labelsFrag.appendChild(label);
      });

      graphLabelsEl.appendChild(labelsFrag);
    }

    /* ====== åˆæœŸåŒ– ====== */
    document.getElementById("prev-month").addEventListener("click", () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    });

    document.getElementById("next-month").addEventListener("click", () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    });

    function initTodayLabel() {
      todayLabelEl.textContent = formatDateLabel();
    }

    initTodayLabel();
    updateCharCount();
    renderCalendar();
  </script>
</body>
</html>
