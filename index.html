<!DOCTYPE html>
<html lang="ja" data-theme="Crystal">
<head>
  <meta charset="UTF-8" />
  <title>MoodOS v3.9 - MoodCalendar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  /* =========================================
   基本リセット
========================================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  width: 100%;
  height: 100%;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text);
}

/* =========================================
   レイアウト
========================================= */
#app-root {
  display: flex;
  flex-direction: column;
  height: 100vh;
}

/* ===== Header ===== */
.app-header {
  padding: 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.app-title {
  font-size: 24px;
  font-weight: 600;
}

.app-subtitle {
  font-size: 12px;
  opacity: 0.7;
}

.header-buttons {
  display: flex;
  gap: 8px;
}

.header-btn {
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
  cursor: pointer;
  transition: 0.15s;
}

.header-btn:hover {
  opacity: 0.8;
}

/* =========================================
   Main Layout
========================================= */
.app-main {
  flex: 1;
  display: flex;
  overflow: hidden;
}

/* ===== カレンダー ===== */
.calendar-section {
  flex: 1;
  padding: 16px;
  border-right: 1px solid var(--border);
}

.calendar-header-row {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  text-align: center;
  font-weight: 600;
  margin-bottom: 8px;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 4px;
}

.calendar-cell {
  padding: 10px;
  border-radius: 6px;
  text-align: center;
  cursor: pointer;
  background: var(--surface);
  border: 1px solid var(--border);
  transition: 0.15s;
}

.calendar-cell:hover {
  opacity: 0.8;
}

.calendar-cell.selected {
  border: 2px solid var(--accent);
}

/* =========================================
   Side Panel
========================================= */
.side-panel-section {
  width: 320px;
  padding: 16px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.panel-title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 8px;
}

.panel-subtitle {
  font-size: 14px;
  margin-bottom: 4px;
}

/* =========================================
   機械くん
========================================= */
.machine-bubble {
  margin-top: 8px;
  padding: 12px;
  border-radius: 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  display: flex;
  gap: 12px;
  align-items: center;
}

.machine-bubble.hidden {
  display: none;
}

.machine-face {
  width: 32px;
  height: 32px;
  border-radius: 6px;
  border: 1px solid var(--border);
  position: relative;
}

.machine-eye {
  width: 6px;
  height: 6px;
  background: var(--text);
  border-radius: 50%;
  position: absolute;
  top: 10px;
}

.machine-eye.left { left: 8px; }
.machine-eye.right { right: 8px; }

.machine-mouth {
  width: 12px;
  height: 2px;
  background: var(--text);
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
}

/* =========================================
   タスク
========================================= */
.task-input-row {
  display: flex;
  gap: 8px;
}

.task-input {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
}

.secondary-btn {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
  cursor: pointer;
}

.task-list {
  margin-top: 8px;
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.task-item {
  padding: 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* =========================================
   天気
========================================= */
.weather-content {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 12px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
}

/* =========================================
   モーダル
========================================= */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  display: flex;
  justify-content: center;
  align-items: center;
}

.modal-backdrop.hidden {
  display: none;
}

.modal {
  width: 360px;
  background: var(--surface);
  border-radius: 8px;
  border: 1px solid var(--border);
  padding: 16px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-close-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

.mood-buttons-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 12px;
}

.mood-btn {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
  cursor: pointer;
}

.modal-textarea {
  width: 100%;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
}

/* =========================================
   ボタン（共通）
========================================= */
.primary-btn {
  padding: 10px 14px;
  border-radius: 6px;
  border: none;
  background: var(--accent);
  color: white;
  cursor: pointer;
}

.danger-btn {
  padding: 10px 14px;
  border-radius: 6px;
  border: none;
  background: var(--danger);
  color: white;
  cursor: pointer;
}

/* =========================================
   設定パネル
========================================= */
.settings-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.3);
  display: flex;
  justify-content: flex-end;
}

.settings-backdrop.hidden {
  display: none;
}

.settings-panel {
  width: 320px;
  height: 100%;
  background: var(--surface);
  border-left: 1px solid var(--border);
  padding: 16px;
  overflow-y: auto;
}

.theme-card-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}

.theme-card {
  padding: 12px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--surface);
  cursor: pointer;
  text-align: center;
}

/* =========================================
   変数（テーマ側で上書き）
========================================= */
:root {
  --bg: #f5f5f5;
  --surface: #ffffff;
  --border: #d0d0d0;
  --text: #333;
  --accent: #007aff;
  --danger: #ff3b30;
}
/* =========================================
   テーマ変数（Crystal）
========================================= */
html[data-theme="Crystal"] {
  --bg: #f7f9fc;
  --surface: #ffffff;
  --border: #d9e2ec;
  --text: #2e3a45;
  --accent: #4da3ff;
  --danger: #ff4d4d;
}

/* =========================================
   Midnight（深い青の夜）
========================================= */
html[data-theme="Midnight"] {
  --bg: #0d1117;
  --surface: #161b22;
  --border: #30363d;
  --text: #c9d1d9;
  --accent: #58a6ff;
  --danger: #ff6b6b;
}

/* =========================================
   Cosmos（宇宙・星屑）
========================================= */
html[data-theme="Cosmos"] {
  --bg: #0b0f2a;
  --surface: #151a3b;
  --border: #2a2f55;
  --text: #e0e6ff;
  --accent: #8f7aff;
  --danger: #ff5f8a;
}

/* =========================================
   Neon（未来・光のライン）
========================================= */
html[data-theme="Neon"] {
  --bg: #0f0f0f;
  --surface: #1a1a1a;
  --border: #333;
  --text: #e6e6e6;
  --accent: #00eaff;
  --danger: #ff3b6b;
}

/* =========================================
   Ruins（遺跡・砂・古代）
========================================= */
html[data-theme="Ruins"] {
  --bg: #f3efe6;
  --surface: #fdfbf7;
  --border: #d6c9b8;
  --text: #4a3f35;
  --accent: #c49b5f;
  --danger: #b85c4c;
}

/* =========================================
   テーマカードのプレビュー色
========================================= */
.theme-preview-crystal {
  background: linear-gradient(135deg, #ffffff, #e8f0ff);
}

.theme-preview-midnight {
  background: linear-gradient(135deg, #0d1117, #1f2937);
}

.theme-preview-cosmos {
  background: linear-gradient(135deg, #0b0f2a, #3a2f7a);
}

.theme-preview-neon {
  background: linear-gradient(135deg, #0f0f0f, #00eaff33);
}

.theme-preview-ruins {
  background: linear-gradient(135deg, #f3efe6, #d6c9b8);
}

/* =========================================
   テーマカード（選択時の強調）
========================================= */
.theme-card.active {
  border: 2px solid var(--accent);
  background: var(--surface);
  opacity: 1;
}

.theme-card:hover {
  opacity: 0.85;
}

  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/theme.css" />
</head>

<body>
  <div id="app-root">

    <!-- =========================
         Header
    ========================== -->
    <header class="app-header">
      <div class="app-title-area">
        <h1 class="app-title">MoodOS</h1>
        <p class="app-subtitle">気分と毎日を、ちいさなOSで。</p>
      </div>

      <div class="app-header-controls">
        <div class="current-date-display">
          <span id="current-year"></span>
          <span> / </span>
          <span id="current-month"></span>
        </div>

        <div class="header-buttons">
          <button id="prev-month-btn" class="header-btn" type="button">◀</button>
          <button id="today-btn" class="header-btn" type="button">今日</button>
          <button id="next-month-btn" class="header-btn" type="button">▶</button>

          <button id="open-settings-btn" class="header-btn settings-btn" type="button">
            ⚙ 設定
          </button>
        </div>
      </div>
    </header>

    <!-- =========================
         Main Layout
    ========================== -->
    <main class="app-main">

      <!-- ===== カレンダー ===== -->
      <section class="calendar-section">
        <div class="calendar-header-row">
          <div class="weekday-label">日</div>
          <div class="weekday-label">月</div>
          <div class="weekday-label">火</div>
          <div class="weekday-label">水</div>
          <div class="weekday-label">木</div>
          <div class="weekday-label">金</div>
          <div class="weekday-label">土</div>
        </div>

        <div id="calendar-grid" class="calendar-grid">
          <!-- JS で生成 -->
        </div>
      </section>

      <!-- ===== 右側パネル ===== -->
      <section class="side-panel-section">

        <!-- 選択中の日付 -->
        <div class="selected-day-panel">
          <h2 class="panel-title">選択中の日付</h2>
          <div class="selected-day-display">
            <span id="selected-date-label">未選択</span>
          </div>

          <!-- 機械くん -->
          <div class="machine-bubble-wrapper">
            <div id="machine-bubble" class="machine-bubble hidden">
              <div class="machine-face">
                <span class="machine-eye left"></span>
                <span class="machine-eye right"></span>
                <span class="machine-mouth"></span>
              </div>
              <div class="machine-message" id="machine-message-text"></div>
            </div>
          </div>

          <!-- 気分サマリー -->
          <div class="day-summary">
            <h3 class="panel-subtitle">その日の気分</h3>
            <div id="day-mood-summary" class="day-mood-summary">
              記録がありません。
            </div>
          </div>

          <!-- 気分記録ボタン -->
          <div class="day-actions">
            <button id="open-mood-modal-btn" class="primary-btn" type="button">
              今日の気分を記録する
            </button>
          </div>
        </div>

        <!-- タスク -->
        <div class="task-panel">
          <h2 class="panel-title">今日のタスク</h2>
          <div class="task-input-row">
            <input id="new-task-input" type="text" class="task-input" placeholder="タスクを入力して Enter" />
            <button id="add-task-btn" class="secondary-btn" type="button">追加</button>
          </div>
          <ul id="task-list" class="task-list"></ul>
        </div>

        <!-- 天気 -->
        <div class="weather-panel">
          <h2 class="panel-title">明日の天気</h2>
          <div id="weather-content" class="weather-content">
            <div class="weather-icon-placeholder">☁</div>
            <div class="weather-text">
              <div id="weather-main" class="weather-main">読み込み待ち</div>
              <div id="weather-temp" class="weather-temp"></div>
              <div id="weather-comment" class="weather-comment">
                機械くんがここで一言しゃべるよ。
              </div>
            </div>
          </div>
        </div>

      </section>
    </main>

    <!-- =========================
         Mood Modal
    ========================== -->
    <div id="mood-modal-backdrop" class="modal-backdrop hidden">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">今日の気分を記録</h2>
          <button id="close-mood-modal-btn" class="modal-close-btn" type="button">×</button>
        </div>

        <div class="modal-body">
          <div class="mood-buttons-row">
            <button class="mood-btn" data-mood="great">最高</button>
            <button class="mood-btn" data-mood="good">いい感じ</button>
            <button class="mood-btn" data-mood="neutral">ふつう</button>
            <button class="mood-btn" data-mood="bad">ちょっとつらい</button>
            <button class="mood-btn" data-mood="awful">最悪</button>
          </div>

          <div class="modal-section">
            <label for="mood-note-input" class="modal-label">メモ</label>
            <textarea id="mood-note-input" class="modal-textarea" rows="4"></textarea>
          </div>

          <div class="modal-section">
            <label for="negative-note-input" class="modal-label">嫌だったこと</label>
            <textarea id="negative-note-input" class="modal-textarea negative" rows="3"></textarea>
            <div class="negative-actions">
              <button id="launch-negative-btn" class="danger-btn">嫌なことを宇宙に飛ばす</button>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button id="save-mood-btn" class="primary-btn">記録を保存</button>
        </div>
      </div>

      <div id="negative-launch-layer" class="negative-launch-layer hidden">
        <div class="negative-card" id="negative-card-visual"></div>
        <div class="space-background"></div>
      </div>
    </div>

    <!-- =========================
         Settings Panel
    ========================== -->
    <div id="settings-backdrop" class="settings-backdrop hidden">
      <div class="settings-panel">
        <div class="settings-header">
          <h2 class="settings-title">設定</h2>
          <button id="close-settings-btn" class="settings-close-btn">×</button>
        </div>

        <div class="settings-body">

          <!-- テーマ -->
          <section class="settings-section">
            <h3 class="settings-section-title">テーマ</h3>
            <div class="theme-card-grid">
              <button class="theme-card" data-theme="Crystal">Crystal</button>
              <button class="theme-card" data-theme="Midnight">Midnight</button>
              <button class="theme-card" data-theme="Cosmos">Cosmos</button>
              <button class="theme-card" data-theme="Neon">Neon</button>
              <button class="theme-card" data-theme="Ruins">Ruins</button>
            </div>
          </section>

        </div>
      </div>
    </div>

    <!-- =========================
         Audio
    ========================== -->
    <audio id="ui-sound-tap" src="" preload="auto"></audio>
    <audio id="ui-sound-save" src="" preload="auto"></audio>
    <audio id="ui-sound-close" src="" preload="auto"></audio>
    <audio id="ui-sound-launch" src="" preload="auto"></audio>

  </div>

  /* =========================================
   MoodOS v3.9 - theme.js
   テーマ切り替え・保存・復元
========================================= */

/* ===== テーマ適用 ===== */
function applyTheme(themeName) {
  document.documentElement.setAttribute("data-theme", themeName);
  localStorage.setItem("moodos-theme", themeName);
  updateThemeCardActive(themeName);
  updateMachineMessage(themeName);
}

/* ===== テーマカードの active 表示 ===== */
function updateThemeCardActive(activeTheme) {
  const cards = document.querySelectorAll(".theme-card");
  cards.forEach(card => {
    const theme = card.getAttribute("data-theme");
    if (theme === activeTheme) {
      card.classList.add("active");
    } else {
      card.classList.remove("active");
    }
  });
}

/* =========================================
   機械くんのテーマ別セリフ
========================================= */
const themeMessages = {
  Crystal: [
    "透き通った気持ちでいこう。",
    "今日もクリアにいこうね。",
    "光が差し込んでるよ。"
  ],
  Midnight: [
    "静かな夜みたいに落ち着いていこう。",
    "深呼吸して、ゆっくりね。",
    "夜の青は心を整えてくれるよ。"
  ],
  Cosmos: [
    "星の海みたいに広く考えてみよう。",
    "宇宙は静かで、でも優しいよ。",
    "今日の気分も、星屑みたいに輝くかも。"
  ],
  Neon: [
    "未来の光が君を照らしてるよ。",
    "ピカッといこう、ピカッと。",
    "スピード感ある一日にしよう。"
  ],
  Ruins: [
    "古代の風がそっと背中を押してるよ。",
    "落ち着いた空気が心地いいね。",
    "ゆっくり進めば大丈夫だよ。"
  ]
};

/* ===== 機械くんのセリフ更新 ===== */
function updateMachineMessage(themeName) {
  const bubble = document.getElementById("machine-bubble");
  const text = document.getElementById("machine-message-text");

  if (!bubble || !text) return;

  const messages = themeMessages[themeName];
  if (!messages) return;

  const random = messages[Math.floor(Math.random() * messages.length)];

  bubble.classList.remove("hidden");
  text.textContent = random;
}

/* =========================================
   初期化処理
========================================= */
function initThemeSystem() {
  const savedTheme = localStorage.getItem("moodos-theme") || "Crystal";
  applyTheme(savedTheme);

  const cards = document.querySelectorAll(".theme-card");
  cards.forEach(card => {
    card.addEventListener("click", () => {
      const theme = card.getAttribute("data-theme");
      applyTheme(theme);
    });
  });
}

/* ===== DOM読み込み後に初期化 ===== */
document.addEventListener("DOMContentLoaded", initThemeSystem);
/* =========================================
   MoodOS v3.9 - app.js
   カレンダー / モーダル / タスク / 天気
========================================= */

/* =========================================
   カレンダー生成
========================================= */
let currentDate = new Date();
let selectedDate = null;

function renderCalendar() {
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();

  document.getElementById("current-year").textContent = year;
  document.getElementById("current-month").textContent = month + 1;

  const grid = document.getElementById("calendar-grid");
  grid.innerHTML = "";

  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month + 1, 0).getDate();

  // 空白セル
  for (let i = 0; i < firstDay; i++) {
    const empty = document.createElement("div");
    grid.appendChild(empty);
  }

  // 日付セル
  for (let d = 1; d <= lastDate; d++) {
    const cell = document.createElement("div");
    cell.className = "calendar-cell";
    cell.textContent = d;

    cell.addEventListener("click", () => selectDate(year, month, d));

    // 選択中の日付を強調
    if (
      selectedDate &&
      selectedDate.year === year &&
      selectedDate.month === month &&
      selectedDate.day === d
    ) {
      cell.classList.add("selected");
    }

    grid.appendChild(cell);
  }
}

function selectDate(year, month, day) {
  selectedDate = { year, month, day };
  document.getElementById("selected-date-label").textContent =
    `${year} / ${month + 1} / ${day}`;

  updateDaySummary();
  renderCalendar();
}

/* =========================================
   気分データ保存
========================================= */
function saveMood() {
  if (!selectedDate) return;

  const key = `${selectedDate.year}-${selectedDate.month}-${selectedDate.day}`;
  const mood = document.querySelector(".mood-btn.selected")?.dataset.mood || "";
  const note = document.getElementById("mood-note-input").value;

  const data = { mood, note };
  localStorage.setItem(`mood-${key}`, JSON.stringify(data));

  closeMoodModal();
  updateDaySummary();
}

function updateDaySummary() {
  if (!selectedDate) return;

  const key = `${selectedDate.year}-${selectedDate.month}-${selectedDate.day}`;
  const data = localStorage.getItem(`mood-${key}`);
  const summary = document.getElementById("day-mood-summary");

  if (!data) {
    summary.textContent = "記録がありません。";
    return;
  }

  const parsed = JSON.parse(data);
  summary.textContent = `気分：${parsed.mood} / メモ：${parsed.note}`;
}

/* =========================================
   モーダル開閉
========================================= */
function openMoodModal() {
  document.getElementById("mood-modal-backdrop").classList.remove("hidden");
}

function closeMoodModal() {
  document.getElementById("mood-modal-backdrop").classList.add("hidden");
}

/* =========================================
   嫌なことを宇宙に飛ばす演出
========================================= */
function launchNegative() {
  const text = document.getElementById("negative-note-input").value;
  if (!text) return;

  const layer = document.getElementById("negative-launch-layer");
  const card = document.getElementById("negative-card-visual");

  card.textContent = text;
  layer.classList.remove("hidden");

  setTimeout(() => {
    layer.classList.add("hidden");
    document.getElementById("negative-note-input").value = "";
  }, 2000);
}

/* =========================================
   タスク管理
========================================= */
function addTask() {
  const input = document.getElementById("new-task-input");
  const text = input.value.trim();
  if (!text) return;

  const list = document.getElementById("task-list");

  const li = document.createElement("li");
  li.className = "task-item";
  li.textContent = text;

  li.addEventListener("click", () => li.remove());

  list.appendChild(li);
  input.value = "";
}

/* =========================================
   天気（ダミーAPI）
========================================= */
function loadWeather() {
  document.getElementById("weather-main").textContent = "晴れ";
  document.getElementById("weather-temp").textContent = "18℃";
  document.getElementById("weather-comment").textContent =
    "明日は気持ちよく過ごせそうだよ。";
}

/* =========================================
   イベント登録
========================================= */
function initEvents() {
  document.getElementById("prev-month-btn").addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  document.getElementById("next-month-btn").addEventListener("click", () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  document.getElementById("today-btn").addEventListener("click", () => {
    currentDate = new Date();
    renderCalendar();
  });

  document.getElementById("open-mood-modal-btn").addEventListener("click", openMoodModal);
  document.getElementById("close-mood-modal-btn").addEventListener("click", closeMoodModal);
  document.getElementById("save-mood-btn").addEventListener("click", saveMood);

  document.getElementById("launch-negative-btn").addEventListener("click", launchNegative);

  document.getElementById("add-task-btn").addEventListener("click", addTask);
  document.getElementById("new-task-input").addEventListener("keydown", (e) => {
    if (e.key === "Enter") addTask();
  });

  document.getElementById("open-settings-btn").addEventListener("click", () => {
    document.getElementById("settings-backdrop").classList.remove("hidden");
  });

  document.getElementById("close-settings-btn").addEventListener("click", () => {
    document.getElementById("settings-backdrop").classList.add("hidden");
  });

  // 気分ボタンの選択
  document.querySelectorAll(".mood-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".mood-btn").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
    });
  });
}

/* =========================================
   初期化
========================================= */
document.addEventListener("DOMContentLoaded", () => {
  renderCalendar();
  loadWeather();
  initEvents();
});

  <script src="js/theme.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
